**********************************************************
        _                       ____
       ( )                     |____|
    ___|/________|\____________|____|_______
   |__/|/_)_|____|_______|\__(_)__(_)_______|
   |_(_|_/__|__(_)_______|\_________________|
   |___|____|__________(_)__________________|
   |________|_________________________(_)___|
                                        |
                                        | 

Changing Their Tune: How Consumers' Adoption of Online 
Streaming Affects Music Consumption and Discovery


                REPLICATION FILES


by Hannes Datta, George Knox and Bart Bronnenberg
Marketing Science, forthcoming

E-mail of corresponding author: h.datta@tilburguniversity.edu

Last update: 17 July 2017

**********************************************************





!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

IMPORTANT: Data shared with the public
is simulated for confidentiality reasons.
Hence, the code does not replicate the
reported tables, but merely illustrates 
how it works.

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!





====================================================
SETUP
====================================================

- requires Stata 14, and the following packages
  (installation commands below):

ssc install rtfutil, replace
ssc install scheme_tufte, replace
ssc install mahapick, replace 
ssc install coefplot, replace
ssc install estout, replace
ssc install fitstat, replace

====================================================
DIRECTORY STRUCTURE
====================================================

  \code: contains data preparation and analysis code
  \external: contains data
  \output: contains output generated by code (tables, figures)
  \temp: holds temporary files generated by code


====================================================
DESCRIPTION OF \CODE
=====================================================

(If executing code manually, please adhere to the order below for files 1-6).

1) importing_spotify_panel.do
Reads raw data from CSV, stores it as Stata data file (dta)

2) matching.do
Performs propensity score matching; generates diagnostic figures

3) preclean.do
Combines panel data (from 1) with matching sample (from 2); sets variable labels

4) tables.do
Performs all analyses and produces rtf tables and figures for slides and paper stored in \output

5) common.do
Holds a few functions commonly used by several of the do files in this directory

6) marketshare_plot.do
Produces plot of the raw data (market shares by platform)

====================================================
RUNNING THE ANALYSIS
=====================================================

To replicate the analysis, first follow the setup instructions above, 
and then run either (a) make.bat, or (b) make. Details below.

(a) make.bat

The simplest way to replicate the analysis is to execute make.bat.
Please configure the local variable statapath to point to your
own Stata package (edit the path directly in the .bat file).


(b) GNU Make 32

GNU Make 32 is a more advanced implementation of make.bat, allowing for sequential builds of the project. 
Makefile (a file without an extension) is used as input to GNU Make 32. Makelog.bat runs GNU Make 32, and produces a log.

GNU Make 32 also requires a file located at C:\make_research, setting the paths to the required software programs:

An example from the author's make_research looks like this:

    CONTENT OF C:\make_research
    
    # path to cmd.exe for command line interface, should be the same
    SHELL=C:/Windows/System32/cmd.exe
    # path to Stata 14
    STATABIN="c:\Program Files (x86)\Stata14\StataSE-64.exe"

====================================================
OUTPUT
=====================================================

Once all code is run successfully, the output directory will
contain the following files.

Tables
======

main.rtf                    Main tables from the paper
matchlogit.rtf              Propensity score estimates from the matching model
appendix.rtf                Appendix D from the paper (additional descriptive statistics)
robust.rtf                  Appendix E from the paper (robustness checks)

Figures
=======

raw_share_col.emf           Market share plot (Figure 1 in the paper), color
raw_share_col.gph           ...
raw_share_col.png           ...
figure1.pdf                 Market share plot (Figure 1 in the paper), greyscale
figure1.eps                 ...
raw_share.emf               ...
raw_share.gph               ...
raw_share.png               ...
slides_discovery_top.png    Figure for slides: discovery at the top
slides_discovery.png        Figure for slides: Effect on discovery
slides_discovery_repeat.png Figure for slides: Effect on repeat consumption
slides_herfindahl.png       Figure for slides: Concentration
slides_superstar.png        Figure for slides: Superstar concentration
slides_uniq.png             Figure for slides: Effect on unique varieties
slides_log_qty.png          Figure for slides: Effect on quantity of consumption
before_after_overlap.emf    Overlap in propensity scores after matching
before_after_overlap.png    ...
before_after_propensity.emf Overlap in propensity scores before matching
before_after_propensity.png ...
figure2.eps                 Combination of propensity scores before and after matching (Figure 2 in paper)
figure2.pdf                 ...
slides_logit.png            Figure for slides: Logit propensity estimates
adoption_moment.emf         Figure for appendix: Distribution of adoption times
adoption_moment.png         ...